"use strict";(self.webpackChunkmongkol_serey_cms=self.webpackChunkmongkol_serey_cms||[]).push([[660],{25660:function(e,n,r){r.r(n),r.d(n,{default:function(){return me}});var t=r(29439),o=r(35527),i=r(53767),a=r(72466),s=r(63466),l=r(39281),c=r(79836),d=r(53382),u=r(35855),x=r(53994),p=r(20890),h=r(57246),m=r(58536),Z=r(50841),f=r(72791),j=r(39421),g=r(62643),v=r(60826),y=r(85871),b=r(69780),w=r(66254),S=r(45987),C=r(1413),P=r(55931),D=r(5574),k=r(80184),R=["open","onCloseDialog","children","size"],T=f.forwardRef((function(e,n){return(0,k.jsx)(P.Z,(0,C.Z)((0,C.Z)({direction:"up",ref:n},e),{},{unmountOnExit:!0}))})),I=function(e){var n=e.open,r=e.onCloseDialog,t=e.children,o=e.size,i=(0,S.Z)(e,R),a=(0,b.Z)().isMdDown;return(0,k.jsx)(D.Z,(0,C.Z)((0,C.Z)({open:n,onClose:r,maxWidth:o||"lg",fullWidth:!0,TransitionComponent:T,PaperProps:{sx:{height:["100%","100%","sm"===o?"50vh":"90vh"]}},fullScreen:a},i),{},{children:t}))},z=r(96349),E=r(76509),W=r(93433),A=r(68870),B=r(61889),F=r(90493),N=r(15021),V=r(20653),M=r(49900),O=r(84395),_=r(34663),q=r(36151),Q=r(12065),$=r(79971),G=r(94668),L=r(48072),K=r(16725),U=r(59941),H=r(64370),J=r(61134),X=r(82139),Y=r(64884),ee=r(93025),ne=r(66172),re=r(51505),te=r(17139),oe=r(8694),ie=r(86544),ae=["onChange"];var se=function(e){var n=e.index,r=e.onRemove,t=e.defaultTitle,o=(0,J.Gc)(),a=o.control,l=o.setValue,c=o.getValues,d=(0,b.Z)().isSmDown;return(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(i.Z,{direction:d?"column":"row",spacing:2,children:[(0,k.jsx)(J.Qr,{control:a,name:"expenseRowData.".concat(n,".title"),rules:{required:{value:!0,message:"Title is required"}},defaultValue:t,render:function(e){var n=e.field,r=e.fieldState.error;return(0,k.jsx)(ee.Z,(0,C.Z)({placeholder:"Title",size:"small",error:Boolean(r),helperText:null===r||void 0===r?void 0:r.message},n))}}),(0,k.jsx)(J.Qr,{control:a,name:"expenseRowData.".concat(n,".totalPrice"),defaultValue:0,rules:{required:{value:!0,message:"Total price is required"},pattern:{value:oe.V0.numberOnly,message:"Price is number only"}},render:function(e){var n=e.field,r=e.fieldState.error;return(0,k.jsx)(ee.Z,(0,C.Z)({placeholder:"Total price",size:"small",error:Boolean(r),helperText:null===r||void 0===r?void 0:r.message,InputProps:{startAdornment:(0,k.jsx)(s.Z,{position:"start",children:(0,k.jsx)(re.Z,{size:"16",color:w.Z.palette.primary.main})})}},n))}}),(0,k.jsx)(J.Qr,{control:a,name:"expenseRowData.".concat(n,".paidBy"),defaultValue:"",render:function(e){var r=e.field,t=(r.onChange,(0,S.Z)(r,ae));return(0,k.jsx)(ne.Z,(0,C.Z)((0,C.Z)({freeSolo:!0,disableClearable:!0,openOnFocus:!0,fullWidth:!0},t),{},{onInputChange:function(e,r){l("expenseRowData.".concat(n,".paidBy"),r)},renderInput:function(e){return(0,k.jsx)(ee.Z,(0,C.Z)((0,C.Z)({},e),{},{placeholder:"Paid by",size:"small",sx:{"& .MuiOutlinedInput-root":{bgcolor:X.cF[c("expenseRowData.".concat(n,".paidBy"))]||w.Z.palette.common.white,color:X.cF[c("expenseRowData.".concat(n,".paidBy"))]?w.Z.palette.common.white:w.Z.palette.common.black,borderColor:X.cF[c("expenseRowData.".concat(n,".paidBy"))]}}}))},options:X.u7.map((function(e){return e}))}))}}),(0,k.jsx)(J.Qr,{control:a,name:"expenseRowData.".concat(n,".other"),defaultValue:"",render:function(e){var n=e.field;return(0,k.jsx)(ee.Z,(0,C.Z)((0,C.Z)({placeholder:"Other"},n),{},{size:"small"}))}}),(0,k.jsx)(ie.Q,{onClick:r,sx:{background:function(e){return e.palette.error.main},color:function(e){return e.palette.common.white},"&:hover":{background:function(e){return(0,Q.Fq)(e.palette.error.main,.8)}}},children:(0,k.jsx)(te.Z,{size:"24"})})]})})},le=r(72426),ce=r.n(le),de=r(5247),ue=r(59860);var xe=function(e){var n,r,a,s,l,c=e.onAddExpenseSuccess,d=e.orderDetail,u=e.onCloseDialogClick,x=(0,Y.Z)(z.Z.addExpense,{manual:!0,onSuccess:function(){return c()},onError:function(){return re(!0)}}),h=(0,J.cI)(),m=h.handleSubmit,Z=h.setValue,g=h.watch,v=(0,f.useState)(!0),y=(0,t.Z)(v,2),S=y[0],P=y[1],D=(0,f.useState)([]),R=(0,t.Z)(D,2),T=R[0],I=R[1],E=(0,f.useState)(!1),ee=(0,t.Z)(E,2),ne=ee[0],re=ee[1],te=(0,b.Z)().isSmDown,oe=(null===d||void 0===d||null===(n=d.finalInvoices)||void 0===n?void 0:n.reduce((function(e,n){return e+n.price}),0))||0,ie=(null===d||void 0===d||null===(r=d.expenses)||void 0===r?void 0:r.reduce((function(e,n){return e+n.price}),0))||0,ae=oe-ie;return(0,f.useEffect)((function(){if(null!==d&&void 0!==d&&d.expenses&&d.expenses.length>0){var e=d.expenses.map((function(e){return{id:e.id,title:e.expense_on,other:e.note,paidBy:e.paidBy,totalPrice:e.price}}));I(e),Z("expenseRowData",e)}else I(X.lE);setTimeout((function(){P(!1)}),500)}),[]),S?(0,k.jsx)(i.Z,{height:"100%",justifyContent:"center",alignItems:"center",children:(0,k.jsx)(A.Z,{sx:{bgcolor:"common.white",p:10,borderRadius:4},children:(0,k.jsx)(j.W,{})})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(de.Z,{open:ne,onCloseDialog:function(){return re(!1)},errorTitle:"Internal Server Error",errorMessage:(null===(a=x.error)||void 0===a?void 0:a.message)||"Something went wrong! Couldn't add expense to this order."}),(0,k.jsx)(J.RV,(0,C.Z)((0,C.Z)({},h),{},{children:(0,k.jsx)("form",{onSubmit:m((function(e){var n;null!==d&&void 0!==d&&d.id&&x.run(d.id,null===(n=e.expenseRowData)||void 0===n?void 0:n.map((function(e){return{id:(null===e||void 0===e?void 0:e.id)||void 0,expense_on:e.title||"",note:e.other||"",paidBy:e.paidBy||"",price:+e.totalPrice||0}})))})),children:(0,k.jsxs)(B.ZP,{container:!0,sx:{height:["auto","auto","90vh"]},children:[(0,k.jsx)(B.ZP,{item:!0,xs:12,md:3,sx:{background:"transparent",position:"relative",height:["auto","auto","100%"]},children:(0,k.jsxs)(o.Z,{sx:{overflow:"hidden",borderRadius:{xs:0,md:2}},children:[(0,k.jsxs)(F.Z,{disablePadding:!0,children:[(0,k.jsxs)(N.ZP,{children:[(0,k.jsx)(V.Z,{children:(0,k.jsx)($.Z,{size:"24",color:w.Z.palette.primary.main})}),(0,k.jsx)(M.Z,{primary:null!==d&&void 0!==d&&d.id?function(e){var n="00000";return n.substring(0,n.length-e.length)+e}(d.id.toString()):"N/A",secondary:"Invoice ID"})]}),(0,k.jsxs)(N.ZP,{children:[(0,k.jsx)(V.Z,{children:(0,k.jsx)(G.Z,{size:"24",color:w.Z.palette.primary.main})}),(0,k.jsx)(M.Z,{primary:(null===d||void 0===d||null===(s=d.customer)||void 0===s?void 0:s.customer_name)||"No Customer",secondary:"Customer"})]}),(0,k.jsxs)(N.ZP,{children:[(0,k.jsx)(V.Z,{children:(0,k.jsx)(L.Z,{size:"24",color:w.Z.palette.primary.main})}),(0,k.jsx)(M.Z,{primary:(null===d||void 0===d||null===(l=d.customer)||void 0===l?void 0:l.contact_number)||"No phone number",secondary:"Phone Number"})]}),(0,k.jsxs)(N.ZP,{children:[(0,k.jsx)(V.Z,{children:(0,k.jsx)(K.Z,{size:"24",color:w.Z.palette.primary.main})}),(0,k.jsx)(M.Z,{primary:ce()(null===d||void 0===d?void 0:d.date).format("DD-MM-yyyy")||"N/A",secondary:"Event Date"})]}),(0,k.jsxs)(N.ZP,{children:[(0,k.jsx)(V.Z,{children:(0,k.jsx)(U.Z,{size:"24",color:w.Z.palette.primary.main})}),(0,k.jsx)(M.Z,{primary:(null===d||void 0===d?void 0:d.location)||"N/A",secondary:"Location"})]})]}),(0,k.jsxs)(F.Z,{disablePadding:!0,children:[(0,k.jsx)(N.ZP,{sx:{bgcolor:function(e){return e.palette.success.main}},children:(0,k.jsx)(M.Z,{primary:"$".concat(Intl.NumberFormat().format(oe)),secondary:"Total Income",primaryTypographyProps:{fontSize:24,fontWeight:"medium",letterSpacing:0,color:"white"}})}),(0,k.jsx)(N.ZP,{sx:{bgcolor:function(e){return e.palette.primary.main}},children:(0,k.jsx)(M.Z,{primary:"$".concat(Intl.NumberFormat().format(ie)),secondary:"Total Expense",primaryTypographyProps:{fontSize:24,fontWeight:"medium",letterSpacing:0,color:"white"}})}),(0,k.jsx)(N.ZP,{sx:{bgcolor:function(e){return e.palette.info.main}},children:(0,k.jsx)(M.Z,{primary:"$".concat(Intl.NumberFormat().format(ae)),secondary:"Total Net Profit",primaryTypographyProps:{fontSize:24,fontWeight:"medium",letterSpacing:0,color:"white"}})})]})]})}),(0,k.jsx)(B.ZP,{item:!0,xs:12,md:9,sx:{height:["auto","auto","100%"],px:{xs:0,md:2},mt:{xs:2,md:0}},children:(0,k.jsxs)(o.Z,{sx:{height:"100%",px:2,overflow:"auto",borderRadius:{xs:0,md:2}},children:[(0,k.jsx)(O.Z,{sx:{position:"sticky",bgcolor:function(e){return e.palette.common.white},boxShadow:0,borderRadius:0,borderTopLeftRadius:{xs:0,md:2},borderTopRightRadius:{xs:0,md:2},mb:2,"&.css-hyum1k-MuiToolbar-root":{px:0}},children:(0,k.jsx)(_.Z,{children:(0,k.jsxs)(i.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{width:"100%"},children:[(0,k.jsx)(p.Z,{variant:"h6",children:"Add Expense"}),(0,k.jsxs)(i.Z,{direction:"row",spacing:4,sx:{width:["auto","30%"]},children:[(0,k.jsx)(q.Z,{variant:"contained",fullWidth:!0,onClick:function(){return u()},sx:{borderRadius:2,textTransform:"capitalize",boxShadow:1,color:function(e){return e.palette.common.white},background:function(e){return e.palette.error.main},"&:hover":{color:function(e){return e.palette.common.white},background:function(e){return e.palette.error.main}}},children:"Cancel"}),(0,k.jsx)(ue.Z,{type:"submit",variant:"contained",fullWidth:!0,loading:x.loading,sx:{borderRadius:2,textTransform:"capitalize",boxShadow:1,color:function(e){return e.palette.common.white},"&:hover":{background:function(e){return e.palette.primary.main}}},children:"Save"})]})]})})}),!te&&(0,k.jsxs)(i.Z,{direction:"row",children:[(0,k.jsx)(p.Z,{sx:{flex:1},children:"Title"}),(0,k.jsx)(p.Z,{sx:{flex:1},children:"Total Price"}),(0,k.jsx)(p.Z,{sx:{flex:1},children:"Paid By"}),(0,k.jsx)(p.Z,{sx:{flex:1},children:"Other"}),(0,k.jsx)("div",{style:{width:40}})]}),(0,k.jsxs)(i.Z,{spacing:2,sx:{py:2},children:[(0,k.jsx)(k.Fragment,{children:T.map((function(e,n){return(0,k.jsx)(se,{defaultTitle:e.title,index:n,onRemove:function(){return function(e){var n=g("expenseRowData");n.splice(e,1),Z("expenseRowData",(0,W.Z)(n)),I((0,W.Z)(n))}(n)}},n)}))}),(0,k.jsx)(q.Z,{variant:"contained",startIcon:(0,k.jsx)(H.Z,{}),fullWidth:!0,onClick:function(){I([].concat((0,W.Z)(T),[{id:void 0,title:"",totalPrice:0,paidBy:"",other:""}]))},size:"small",sx:{color:w.Z.palette.primary.main,boxShadow:w.Z.shadows[0],borderRadius:2,border:"1px dashed ".concat(w.Z.palette.primary.main),background:function(e){return(0,Q.Fq)(e.palette.primary.main,.2)},"&:hover":{background:function(e){return(0,Q.Fq)(e.palette.primary.main,.2)},boxShadow:w.Z.shadows[0]}},children:"Add New"})]})]})})]})})}))]})},pe=r(71856),he=r(31029);function me(){var e,n,r=(0,Y.Z)(z.Z.getExpense,{manual:!0}),S=(0,Y.Z)(r.runAsync,{manual:!0,debounceWait:500}),C=null===(e=r.data)||void 0===e?void 0:e.data,P=(0,f.useState)("pending"),D=(0,t.Z)(P,2),R=D[0],T=D[1],W=(0,f.useState)(1),A=(0,t.Z)(W,2),B=A[0],F=A[1],N=(0,f.useState)(""),V=(0,t.Z)(N,2),M=V[0],O=V[1],_=(0,f.useState)(),q=(0,t.Z)(_,2),Q=q[0],$=q[1],G=(0,b.Z)().isSmDown;(0,f.useEffect)((function(){""===M?r.run({page:B-1,status:R,search:""}):S.run({page:B-1,status:R,search:M})}),[R,B,M]);var L=(0,f.useCallback)((function(e){return $(C[e])}),[C]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(y.Z,{pageTitle:"Expense"}),(0,k.jsxs)(o.Z,{elevation:1,sx:{mx:2,borderRadius:4,height:"calc(100vh - 100px)",maxWidth:"100%",overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[(0,k.jsxs)(i.Z,{direction:G?"column":"row",alignItems:"flex-start",justifyContent:"space-between",spacing:2,sx:{width:"100%",p:2},children:[(0,k.jsxs)(a.Z,{value:R,exclusive:!0,fullWidth:!0,size:"small",onChange:function(e,n){null!==n&&(T(n),F(1))},sx:{width:["100%","50%","30%"]},children:[(0,k.jsx)(v.Z,{value:"pending",children:"Pending"}),(0,k.jsx)(v.Z,{value:"complete",children:"Completed"}),(0,k.jsx)(v.Z,{value:"all",children:"All"})]}),(0,k.jsx)(g.Z,{placeholder:"Search...",size:"small",fullWidth:G,value:M,onKeyUp:function(e){"Enter"===e.key&&r.run({page:B-1,status:R,search:M})},onChange:function(e){O(e.target.value),F(1)},InputProps:{endAdornment:(0,k.jsx)(s.Z,{position:"end",children:(0,k.jsx)(m.Z,{size:"20",color:w.Z.palette.primary.main})})}})]}),(0,k.jsx)(l.Z,{className:"hide-scrollbar",sx:{flexGrow:1,overflow:"auto"},children:r.loading&&!C?(0,k.jsx)(i.Z,{direction:"column",alignItems:"center",justifyContent:"center",sx:{height:"100%"},children:(0,k.jsx)(j.W,{})}):C&&C.length>0?(0,k.jsxs)(c.Z,{sx:{minWidth:1e3,"& thead tr th":{background:function(e){return e.palette.background.paper},fontWeight:"600",whiteSpace:"nowrap"}},children:[(0,k.jsx)(E.f,{showAction:!1}),(0,k.jsxs)(d.Z,{children:[(0,k.jsx)(pe.M,{exitBeforeEnter:!0,children:r.loading&&(0,k.jsx)(u.Z,{component:he.E.tr,layout:!0,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,transition:{delay:.3,ease:"easeInOut"}},exit:{scale:0,opacity:0,transition:{delay:0,ease:"easeInOut"}},children:(0,k.jsx)(x.Z,{colSpan:8,sx:{textAlign:"center"},children:(0,k.jsx)(j.W,{})})})}),(0,k.jsx)(E.Z,{data:r.loading?[]:C,onAddExpenseClick:L,isExpense:!0})]})]}):(0,k.jsxs)(i.Z,{direction:"column",alignItems:"center",justifyContent:"center",spacing:1,sx:{height:"100%"},children:[(0,k.jsx)(Z.Z,{size:"80",color:w.Z.palette.error.main}),(0,k.jsx)(p.Z,{variant:"h6",color:"error",children:"No Expense Data"})]})}),(0,k.jsx)(i.Z,{alignItems:"center",width:"100%",p:1.5,sx:{bgcolor:"background.paper"},children:(0,k.jsx)(h.Z,{page:B,onChange:function(e,n){F(n)},count:null===(n=r.data)||void 0===n?void 0:n.totalPage,color:"primary",variant:"outlined",sx:{"& .MuiPaginationItem-root":{borderWidth:0}}})})]}),(0,k.jsx)(I,{onCloseDialog:function(){},open:void 0!==Q,PaperProps:{elevation:0,sx:{height:{xs:"100vh",md:"90vh"},backgroundColor:"transparent",borderRadius:0}},children:(0,k.jsx)(xe,{orderDetail:Q,onCloseDialogClick:function(){return $(void 0)},onAddExpenseSuccess:function(){r.refresh(),$(void 0)}})})]})}}}]);
//# sourceMappingURL=660.68c5ac20.chunk.js.map